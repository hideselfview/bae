#!/bin/sh

# Run cargo fmt check in the bae directory
cd bae

echo "Running cargo fmt check..."
cargo fmt -- --check

if [ $? -ne 0 ]; then
    echo ""
    echo "❌ Commit rejected: Code is not formatted correctly"
    echo "Run 'cargo fmt' in the bae directory to fix formatting"
    exit 1
fi

echo "Running dx fmt check..."
dx fmt --check

if [ $? -ne 0 ]; then
    echo ""
    echo "❌ Commit rejected: RSX code is not formatted correctly"
    echo "Run 'dx fmt' in the bae directory to fix formatting"
    exit 1
fi

echo "Running cargo clippy on library..."
cargo clippy --lib -- -D warnings

if [ $? -ne 0 ]; then
    echo ""
    echo "❌ Commit rejected: Clippy found warnings in library code"
    echo "Fix the warnings above and try again"
    exit 1
fi

echo "Running cargo clippy on tests..."
cargo clippy --tests --features test-utils -- -D warnings

if [ $? -ne 0 ]; then
    echo ""
    echo "❌ Commit rejected: Clippy found warnings in test code"
    echo "Fix the warnings above and try again"
    exit 1
fi

echo "✅ Code formatting and clippy checks passed"
exit 0

